<!--
 - Copyright (C) 2008 Google Inc.
 -
 - Licensed under the Apache License, Version 2.0 (the "License");
 - you may not use this file except in compliance with the License.
 - You may obtain a copy of the License at
 -
 -      http://www.apache.org/licenses/LICENSE-2.0
 -
 - Unless required by applicable law or agreed to in writing, software
 - distributed under the License is distributed on an "AS IS" BASIS,
 - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 - See the License for the specific language governing permissions and
 - limitations under the License.
-->
<html>
  <head>
    <title>Domita</title>
    <style type="text/css">
      .testcontainer { background: yellow }
      .testcontainer.passed { background: #c0ffc0 }
    </style>

    <script src="../caja.js" onerror="console.error(this.src)"></script>
    <script src="jsunit.js"></script>
    <script src="asserts.js"></script>
    <script src="unicode.js" onerror="console.error(this.src)"></script>
    <script src="html4-defs.js" onerror="console.error(this.src)"></script>
    <script src="html-sanitizer.js" onerror="console.error(this.src)"></script>
    <script src="domita.js" onerror="console.error(this.src)"></script>

  </head>

  <body onload="jsunitRun()" bgcolor="white">
    <div id="console-results"></div>

    <script type="text/javascript">
      var testImports = ___.copy(___.sharedImports);
      ___.getNewModuleHandler().setImports(testImports);
      attachDocumentStub(
           '-xyz___',
           {
             rewrite:
                 function (uri, mimeType) {
                   if (!/^https?:\/\//i.test(uri)) { return null; }
                   return 'http://gadget-proxy/?url=' + encodeURIComponent(uri)
                       + '&mimeType=' + encodeURIComponent(mimeType);
                 }
           },
           testImports);
      console.log('attached stubs');

      testImports.jsunitRegister = ___.simpleFunc(jsunitRegister);
      testImports.console = {
        log: function () { console.log.apply(console, arguments); },
        warn: function () { console.warn.apply(console, arguments); },
        error: function () { console.error.apply(console, arguments); },
        trace: function () { console.trace(); }
      };
      ___.all2(___.allowCall, testImports.console,
               ['log', 'warn', 'error', 'trace']);
    </script>

    <script src="domita_test_cajoled.js" onerror="console.error(this.src)"
     ></script>

    <script type="text/javascript">
      window.toString = function () { return '[WINDOW]'; };

      // Give unfiltered DOM access so we can check the results of actions.
      testImports.directAccess = {
        getInnerHTML: function (tameNode) {
          return tameNode.node___.innerHTML;
        },
        getAttribute: function (tameNode, name) {
          return tameNode.node___.getAttribute(name);
        }
      };
      ___.all2(___.allowCall, testImports.directAccess,
               ['getInnerHTML', 'getAttribute']);

      testImports.pass = function (id) {
        var node = testImports.document.getElementById(id);
        if (!node) { console.trace(); }
        node = node.node___;
        node.appendChild(document.createTextNode('Passed ' + id));
        node.className = (node.className || '') + ' passed';
      };
      ___.simpleFunc(testImports.pass, 'pass');
    </script>

    <div id="test-get-element-by-id-xyz___" class="testcontainer"></div>
    <div id="test-get-element-by-id-2-xyz___" class="testcontainer"></div>

    <div id="foo"></div>

    <table id="test-element-id-xyz___" class="testcontainer"></table>

    <span id="test-create-element-xyz___" class="testcontainer"></span>

    <div id="test-inner-html-xyz___" class="testcontainer"
     ><a id="bar" href="http://foo.com?a=b&c=d" class="link" title="<click me!>"
       target="_parent">Test <em id="em-xyz___">Not</em>> run yet.</a>
    </div>

    <div class="testcontainer" id="test-forms-xyz___"></div>

    <div class="testcontainer" id="test-no-script-xyz___"></div>

    <p class="testcontainer" id="test-add-event-listener-xyz___">
      <b>click me</b>
    </p>

    <ol class="testcontainer" id="test-get-elements-by-tag-name-xyz___">
      <li>One
      <li>Two
      <li>Three
        <ol><li>Pi</li><li>sqrt(10)</li>
    </ol>

  </body>
</html>
